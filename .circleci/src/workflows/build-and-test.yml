when:
  and:
    - not: << pipeline.git.tag >>
    - not: << pipeline.parameters.build_all >>
jobs:
- build:
    matrix:
      parameters:
        arch:
        - arm64
        nginx-version:
        - 1.27.4
        waf:
        - 'OFF'
    name: build << matrix.nginx-version >> on << matrix.arch >> WAF << matrix.waf >>
- test:
    matrix:
      parameters:
        arch:
        - arm64
        waf:
        - 'OFF'
        base-image:
        - nginx:1.27.4
        nginx-version:
        - 1.27.4
    name: test << matrix.nginx-version >> on << matrix.base-image >>:<< matrix.arch
      >> WAF << matrix.waf >>
    requires:
    - build << matrix.nginx-version >> on << matrix.arch >> WAF << matrix.waf
      >>
