include:
  - local: ".gitlab/common.yml"

.build-and-test-all:
  stage: build-and-test-all
  rules:
    - if: $CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+/
      when: always
    - when: never

build-nginx-all:
  extends:
    - .build-and-test-all
    - .build-nginx
  parallel:
    matrix:
      - ARCH: ["amd64", "arm64"]
        NGINX_VERSION:
          - "1.24.0"
          - "1.26.0"
          - "1.26.1"
          - "1.26.2"
          - "1.26.3"
          - "1.27.0"
          - "1.27.1"
          - "1.27.2"
          - "1.27.3"
          - "1.27.4"
          - "1.27.5"
          - "1.28.0"
          - "1.28.1"
          - "1.28.2"
          - "1.29.0"
          - "1.29.1"
          - "1.29.2"
          - "1.29.3"
          - "1.29.4"
          - "1.29.5"
        WAF: ["ON", "OFF"]
