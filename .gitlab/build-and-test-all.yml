include:
  - local: ".gitlab/common.yml"

.build-and-test-all:
  stage: build-and-test-all
  rules:
    - if: $CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+/
      when: always
    - when: never

build-nginx-all:
  extends:
    - .build-and-test-all
    - .build-nginx
  parallel:
    matrix:
      - ARCH: ["amd64", "arm64"]
        NGINX_VERSION:
          - "1.24.0"
          - "1.26.0"
          - "1.26.1"
          - "1.26.2"
          - "1.26.3"
          - "1.27.0"
          - "1.27.1"
          - "1.27.2"
          - "1.27.3"
          - "1.27.4"
          - "1.27.5"
          - "1.28.0"
          - "1.28.1"
          - "1.28.2"
          - "1.29.0"
          - "1.29.1"
          - "1.29.2"
          - "1.29.3"
          - "1.29.4"
          - "1.29.5"
        WAF: ["ON", "OFF"]

build-openresty-all:
  extends:
    - .build-and-test-all
    - .build-openresty
  parallel:
    matrix:
      - ARCH: ["amd64", "arm64"]
        RESTY_VERSION:
          - "1.25.3.1"
          - "1.25.3.2"
          - "1.27.1.1"
          - "1.27.1.2"
        WAF: ["ON", "OFF"]

build-ingress-nginx-all:
  extends:
    - .build-and-test-all
    - .build-ingress-nginx
  parallel:
    matrix:
      - ARCH: ["amd64", "arm64"]
        INGRESS_NGINX_VERSION:
          - "1.14.3"
          - "1.14.2"
          - "1.14.1"
          - "1.14.0"
          - "1.13.7"
          - "1.13.6"
          - "1.13.5"
          - "1.13.4"
          - "1.13.3"
          - "1.13.2"
          - "1.13.1"
          - "1.13.0"
          - "1.12.8"
          - "1.12.7"
          - "1.12.6"
          - "1.12.5"
          - "1.12.4"
          - "1.12.3"
          - "1.12.2"
          - "1.12.1"
          - "1.12.0"
          - "1.11.8"
          - "1.11.7"
          - "1.11.6"
          - "1.11.5"
          - "1.11.4"
          - "1.11.3"
          - "1.11.2"
          - "1.11.1"
          - "1.11.0"
          - "1.10.6"
          - "1.10.5"
          - "1.10.4"
          - "1.10.3"
          - "1.10.2"
          - "1.10.1"
          - "1.10.0"
