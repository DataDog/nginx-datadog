# Test configuration for endpoint renaming with appsec enabled
# This configuration tests that endpoint renaming defaults to enabled (fallback mode)
# when appsec is enabled, without explicit resource_renaming_enabled directive

thread_pool waf_thread_pool threads=2 max_queue=5;

load_module /datadog-tests/ngx_http_datadog_module.so;

events {
    worker_connections 1024;
}

http {
    datadog_agent_url http://agent:8126;
    datadog_service_name test-service;

    # Enable appsec - this should enable endpoint renaming by default
    datadog_appsec_enabled on;
    datadog_waf_thread_pool_name waf_thread_pool;

    # No explicit datadog_resource_renaming_enabled directive
    # Should default to on (fallback mode) because appsec is enabled

    server {
        listen 80;
        server_name localhost;

        location / {
            return 200 "$datadog_config_json";
        }

        location /api/users {
            return 200 "User endpoint";
        }

        location /api/products {
            return 200 "Product endpoint";
        }

        location /api/orders {
            datadog_tag "http.route" "/api/orders/:id";
            return 200 "Order endpoint";
        }
    }
}
