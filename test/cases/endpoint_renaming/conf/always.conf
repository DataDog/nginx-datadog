# Test configuration for endpoint renaming always mode
# This configuration tests that endpoint renaming works even when http.route is present

load_module /datadog-tests/ngx_http_datadog_module.so;

events {
    worker_connections 1024;
}

http {
    datadog_agent_url http://agent:8126;
    datadog_service_name test-service;

    datadog_resource_renaming_enabled on;
    datadog_resource_renaming_always_simplified_endpoint on;

    server {
        listen 80;
        server_name localhost;

        location / {
            return 200 "$datadog_config_json";
        }

        location /api/users {
            return 200 "User endpoint";
        }

        location /api/products {
            return 200 "Product endpoint";
        }

        location /api/orders {
            datadog_tag "http.route" "/api/orders/:id";
            return 200 "Order endpoint";
        }
    }
}
