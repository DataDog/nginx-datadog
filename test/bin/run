#!/bin/sh

cd "$(dirname "$0")/../"

set -e

if [ $(echo ${RESTY_TEST}) = "ON" ] ; then
    . ../openresty-version-info
    cp ../test/cases/auto_propagation/openresty_base_conf/* ../test/cases/auto_propagation/conf/
else
    . ../nginx-version-info
    cp ../test/cases/auto_propagation/nginx_base_conf/* ../test/cases/auto_propagation/conf/
fi
export BASE_IMAGE

printf "      arch : %s\n" "${ARCH}"
printf "base image : %s\n" "${BASE_IMAGE}"
printf " test args : %s\n" "$@"

docker compose build --parallel --progress=plain
python3 -m unittest "$@"
# docker-compose up --abort-on-container-exit