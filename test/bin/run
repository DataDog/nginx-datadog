#!/bin/sh

cd "$(dirname "$0")/../"

set -e

. ../nginx-version-info
export BASE_IMAGE
export NGINX_MODULES_PATH="${NGINX_MODULES_PATH:-/usr/lib/nginx/modules}"
export NGINX_CONF_PATH="${NGINX_CONF_PATH:-/etc/nginx/nginx.conf}"

echo "===============================\n"\
"Running test with:\n"\
  "- ARCH=${ARCH}\n"\
  "- BASE_IMAGE=${BASE_IMAGE}\n"\
  "- NGINX_CONF_PATH=${NGINX_CONF_PATH}\n"\
  "- NGINX_MODULES_PATH=${NGINX_MODULES_PATH}\n"\
"===============================\n"

docker compose build --parallel
python3 -m unittest "$@"
