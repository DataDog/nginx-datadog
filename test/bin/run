#!/bin/sh
set -e 

if [ -z "${BASE_IMAGE}" ]; then
  printf "Missing \"BASE_IMAGE\" environment variable.\n" >&2 
  exit 1
fi

if [ -z "${ARCH}" ]; then
    ARCH="$(arch)"
    export ARCH
fi

cd "$(dirname "$0")/../"

printf "      arch : %s\n" "${ARCH}"
printf "base image : %s\n" "${BASE_IMAGE}"
printf " test args : %s\n" "$@"

docker compose build --parallel --progress=plain
python3 -m unittest "$@"

