#!/bin/sh

cd "$(dirname "$0")/../"

set -e

. ../nginx-version-info
export BASE_IMAGE
export NGINX_MODULES_PATH="${NGINX_MODULES_PATH:-/usr/lib/nginx/modules}"
export NGINX_CONF_PATH="${NGINX_CONF_PATH:-/etc/nginx/nginx.conf}"

printf  "===============================\n"
printf  "Running test with:\n"
printf  " - ARCH=%s\n" "${ARCH}"
printf  " - BASE_IMAGE=%s\n" "${BASE_IMAGE}"
printf  " - NGINX_CONF_PATH=%s\n" "${NGINX_CONF_PATH}"
printf  " - NGINX_MODULES_PATH=%s\n" "${NGINX_MODULES_PATH}"
printf  "===============================\n"

 export DOCKER_DEFAULT_PLATFORM=linux/${ARCH} docker compose build --parallel

# shellcheck disable=SC2046
docker image inspect --format "{{.ID}} {{.RepoTags}} {{.Architecture}}" $(docker image ls -q)

# python3 -m unittest "$@"
